SELECT COUNT(id) AS 'Total_listing_count',
 SUM(IF(marketplace='EBAY', 1, 0)) AS 'eBay_listing_count',
 SUM(IF(marketplace='EBAY', listing_price, 0)) AS 'eBay_listing_price',
 AVG(IF(marketplace='EBAY', listing_price, NULL)) AS 'avarage_eBay_price',
 SUM(IF(marketplace='AMAZON', 1, 0)) AS 'amazon_listing_count',
 SUM(IF(marketplace='AMAZON', listing_price, 0)) AS 'amazon_listing_price',
 AVG(IF(marketplace='AMAZON', listing_price, NULL)) AS 'avarage_amazon_price'
 FROM amazebay.listing;

SELECT best_lister FROM (SELECT owner_email_address AS 'best_lister', count(*) as 'num' 
FROM amazebay.listing GROUP BY owner_email_address) AS temp ORDER BY num DESC limit 1;


SELECT DATE_FORMAT(amazebay.listing.upload_time, '%Y %M') 
AS 'Month', SUM(IF(marketplace='EBAY', 1, 0)) AS 
eBay_listing_count', SUM(IF(marketplace='EBAY', listing_price, 0)) 
AS 'total_eBay_price', AVG(IF(marketplace='EBAY', listing_price, NULL)) 
AS 'avarage_eBay_price', SUM(IF(marketplace='AMAZON', 1, 0)) 
AS 'amazon_listing_count', SUM(IF(marketplace='AMAZON', listing_price, 0)) 
 AS 'total_amazon_price', AVG(IF(marketplace='AMAZON'
, listing_price, NULL)) AS 'avarage_amazon_price' FROM 
amazebay.listing Group by year(upload_time), month(upload_time)
, values(marketplace) ORDER BY Month;

SELECT month, email FROM (SELECT DATE_FORMAT(upload_time, '%Y %M') AS month, owner_email_address AS email 
FROM listing GROUP BY month, email ORDER BY month, COUNT(email) DESC) AS temp GROUP BY month;